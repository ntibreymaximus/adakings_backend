{% extends "base.html" %}
{% block title %}Admin Dashboard | Restaurant Management System{% endblock %}

{% block extra_css %}
{# Styles removed, now using static/css/theme.css and Bootstrap #}
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">

<!-- Page Header -->
<div class="page-header card shadow-sm mb-4">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-auto">
        <div class="page-icon-box">
          <i data-feather="activity"></i>
        </div>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb mb-2">
            <li class="breadcrumb-item"><a href="{% url 'users:dashboard' %}" class="text-decoration-none">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Admin</li>
          </ol>
        </nav>
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="page-title h3 mb-0">Admin Dashboard</h1>
            <p class="text-muted mb-0">Monitor system activities and staff performance</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card stats-card bg-primary text-white shadow-sm">
      <div class="card-body d-flex align-items-center">
        <div class="stats-icon">
          <i data-feather="shield"></i>
        </div>
        <div class="ms-3">
          <h3 class="mb-0">{{ admin_count|default:"0" }}</h3>
          <div class="text-white-50">Administrators</div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card stats-card bg-success text-white shadow-sm">
      <div class="card-body d-flex align-items-center">
        <div class="stats-icon">
          <i data-feather="bell"></i>
        </div>
        <div class="ms-3">
          <h3 class="mb-0">{{ frontdesk_count|default:"0" }}</h3>
          <div class="text-white-50">Frontdesk Staff</div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card stats-card bg-warning shadow-sm"> {# text-dark is default for bg-warning in Bootstrap #}
      <div class="card-body d-flex align-items-center">
        <div class="stats-icon"> {# theme.css handles icon color for bg-warning #}
          <i data-feather="coffee"></i>
        </div>
        <div class="ms-3">
          <h3 class="mb-0">{{ kitchen_count|default:"0" }}</h3>
          <div>Kitchen Staff</div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card stats-card bg-info text-white shadow-sm">
      <div class="card-body d-flex align-items-center">
        <div class="stats-icon">
          <i data-feather="truck"></i>
        </div>
        <div class="ms-3">
          <h3 class="mb-0">{{ delivery_count|default:"0" }}</h3>
          <div class="text-white-50">Delivery Staff</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Recent Users -->
  <div class="col-12 mb-4">
    <div class="card action-card">
      <div class="action-card-header">
        <i data-feather="clock"></i> Recently Added Staff
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Role</th>
                <th>Staff ID</th>
                <th>Date Joined</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for user in recent_users %}
              <tr>
                <td>{{ user.get_full_name|default:user.username }}</td>
                <td>
                  <span class="badge {% if user.role == "admin" %}bg-primary{% elif user.role == "frontdesk" %}bg-success{% elif user.role == "kitchen" %}bg-warning text-dark{% elif user.role == "delivery" %}bg-info{% else %}bg-secondary{% endif %}">
                    {{ user.get_role_display }}
                  </span>
                </td>
                <td>{{ user.staff_id|default:"Not assigned" }}</td>
                <td>{{ user.date_joined|date:"M d, Y" }}</td>
                <td>
                  <a href="{% url "users:staff_detail" user.id %}" class="btn btn-sm btn-info">
                    <i data-feather="edit-2"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center">No recent staff additions</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer text-end">
        <a href="{% url "users:staff_list" %}" class="btn btn-primary btn-sm">View All Staff</a>
      </div>
    </div>
  </div>
</div>

<!-- System Status -->
<div class="row">
  <div class="col-12 mb-4">
    <div class="card action-card">
      <div class="action-card-header">
        <i data-feather="pie-chart"></i> Staff Distribution
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="text-center mt-3">
              <p><strong>Total Staff:</strong> {{ total_staff }}</p>
            </div>
          </div>
          <div class="col-md-6">
            <h5 class="mb-3">Role Distribution</h5>
            <div class="progress mb-3" style="height: 25px">
              <div class="progress-bar bg-primary" role="progressbar" style="width: {{ admin_percentage }}%" aria-valuenow="{{ admin_count|default:0 }}" aria-valuemin="0" aria-valuemax="{{ total_staff }}">
                Admins ({{ admin_percentage }}%)
              </div>
            </div>
            <div class="progress mb-3" style="height: 25px">
              <div class="progress-bar bg-success" role="progressbar" style="width: {{ frontdesk_percentage }}%" aria-valuenow="{{ frontdesk_count|default:0 }}" aria-valuemin="0" aria-valuemax="{{ total_staff }}">
                Frontdesk ({{ frontdesk_percentage }}%)
              </div>
            </div>
            <div class="progress mb-3" style="height: 25px">
              <div class="progress-bar bg-warning" role="progressbar" style="width: {{ kitchen_percentage }}%" aria-valuenow="{{ kitchen_count|default:0 }}" aria-valuemin="0" aria-valuemax="{{ total_staff }}">
                Kitchen ({{ kitchen_percentage }}%)
              </div>
            </div>
            <div class="progress mb-3" style="height: 25px">
              <div class="progress-bar bg-info" role="progressbar" style="width: {{ delivery_percentage }}%" aria-valuenow="{{ delivery_count|default:0 }}" aria-valuemin="0" aria-valuemax="{{ total_staff }}">
                Delivery ({{ delivery_percentage }}%)
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
